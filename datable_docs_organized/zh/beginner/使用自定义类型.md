# 使用自定义类型

> 来源: https://www.datable.cn/docs/beginner/usecustomtype

  * [](/)
  * [新手教程](新手教程.md)
  * 使用自定义类型

版本：4.x

本页总览

# 使用自定义类型

实践中经常遇到定义枚举和自定义结构的情况，Luban完美支持这个特性。

详细定义文档见[schema逻辑结构](../manual/schema 逻辑结构.md)，详细数据文档见[Excel格式（初级）](../manual/excel格式（初级）.md)和[Excel格式（高级）](../manual/excel格式（高级）.md)。

## 定义普通枚举​

我们以定义Color枚举为例。

打开`__enums__.xlsx`（一般在Datas目录下），添加如下数据：

| ##var | full_name | unique | flags | group | comment | tags | items | items | items | items | items |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##var | | | | | | | name | alias | value | comment | tags |
| ## | 全名(包含模块和名字) | 枚举项是否唯一 | 是否为位标记枚举（即每个枚举项为位标记数据，例如 System.IO.FileMode, 填数据时可以为 READ\|WRITE 这样） | | | | 枚举名 | 别名 | 值 | 注释 | |
| | test.Color | TRUE | FALSE | | | | RED | 红 | 1 | 红色 | |
| | | | | | | | GREEN | 绿 | 2 | 绿色 | |
| | | | | | | | BLUE | 蓝 | 3 | 蓝色 | |
| | | | | | | | WHITE | 白 | 4 | 白色 | |

字段解释详细见[enum逻辑结构](../manual/schema 逻辑结构.md#enum)。

建议flags=false、unique=true，即非标志枚举，枚举项唯一。

配置枚举类型的数据时，可以填枚举项名，枚举项别名，枚举项值，即RED、红、1这几个都对应RED这个枚举。

## 定义标志类型枚举​

有的枚举类型的枚举项是标志位，使用时可以多个组合，我们以AccessFlag为例。

| ##var | full_name | unique | flags | items | items | items | items |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##var | | | | name | alias | value | comment |
| ## | | | | 枚举名 | 别名 | 值 | 注释 |
| | AccessFlag | TRUE | TRUE | READ | 读 | 1 | 读 |
| | | | | WRITE | 写 | 2 | 写 |
| | | | | EXECUTE | 执行 | 4 | 执行 |
| | | | | READ_WRITE | 读写 | 3 | 读写 |

flags=true表示这是标志类型枚举。

配置标志类型枚举时，即使可以像普通枚举类型那样只用一个枚举项，如`READ`；也可以用'|'来组合多个枚举项，如`READ|EXECUTE`、`写|执行`。

## 填写枚举数据​

当使用标志类型枚举（flags=true）时，如果某个字段需要支持多个标志位的组合，可以在表头中为该字段创建多个同名列，并在`##var`行中指定每个列对应的标志位枚举项。例如下面的示例中，`x3`列有4个同名列，分别对应`READ`、`WRITE`、`APPEND`、`TRUNCT`四个标志位。

`##group`行用于指定字段的分组，`c`表示客户端（client），`s`表示服务端（server）。

| ##var | id | x1 | x2 | x3 | x3 | x3 | x3 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##type | int | Quality | AccessFlag | AccessFlag | AccessFlag | AccessFlag | |
| ##var | | | | READ | WRITE | APPEND | TRUNCT |
| ##group | | c | s | | | | |
| ## | id | | | | | | |
| | 1001 | RED | READ | 1 | | 1 | |
| | 1002 | WHITE | WRITE | | 1 | | 1 |
| | 1003 | 红 | READ\|WRITE | 1 | | | |
| | 1004 | 1 | 读 | | 1 | | |
| | 1005 | 2 | 写 | 1 | 1 | 1 | 1 |
| | 1006 | 红 | | 6 | | | |
| | 1007 | 红 | | 7 | 1 | | |

## 定义普通结构类型​

我们以常见的道具结构为例。打开`__beans__.xlsx`，添加以下数据：

字段说明：
- `parent`: 父类型，用于继承
- `valueType`: 值类型，用于定义容器类型的元素类型
- `sep`: 分割符，用于紧凑格式（见下文）
- `variants`: 字段变体，用于定义字段的不同变体形式

| ##var | full_name | parent | valueType | sep | alias | comment | group | tags | fields | fields | fields | fields | fields | fields | fields |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##var | | | | | | | | | name | alias | type | group | comment | tags | variants |
| ## | 全名(包含模块和名字) | 父类型 | 值类型 | 分割符 | | | | | 字段名 | 字段别名 | 类型 | 分组 | 注释 | | 字段变体 |
| | test.Item | | | | | | | | item_id | | int | | 道具id | | |
| | | | | | | | | | count | | int | | 道具个数 | | |

## 填写结构类型数据​

默认情况下，结构中每个字段都要占一个单元格，字段名需要占多个单元格，以表示这几个单元格内的数据对应结构的每个字段，此时需要合并单元格。

如果在使用csv这种不支持合并单元格的文件格式，可以使用`[{字段名}`和`{字段名}]`放在起始和结束列，表示这个字段占多列。

也可以使用sep在一个字段格内填写整个结构，`sep=,`表示使用','分割单元格数据，分割后的数据作为结构的字段。

当结构的字段很多时，连续填写字段容易出错，此时可以使用多级标题头格式，指定每个成员字段所在的列，文档详见[多级标题头](../manual/excel格式（高级）.md#%E5%A4%9A%E7%BA%A7%E6%A0%87%E9%A2%98%E5%A4%B4)。

| ##var | id | item | item | [item2 | item2] | item3 | item4 | item4 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##type | int | test.Item | test.Item | test.Item | | test.Item#sep=, | test.Item | test.Item |
| ##var | | | | | | | item_id | count |
| ##group | | | | | | | | |
| ## | | | | | | | | |
| | 1 | 1001 | 10 | 1001 | 10 | 1001,10 | 1001 | 10 |
| | 2 | 1002 | 2 | 1002 | 2 | 1002,2 | 1002 | 2 |

## 紧凑结构类型​

如果某个结构总是以紧凑的方式在一个单元格内填写数据，可以直接结构定义时定义sep属性。我们以MyVec3为例：

| ##var | full_name | parent | valueType | sep | alias | comment | group | tags | fields | fields | fields |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| ##var | | | | | | | | | name | alias | type | group | comment |
| ## | | | | 分割符 | | | | | 字段名 | 字段别名 | 类型 | 分组 | 注释 |
| | MyVec3 | | | , | | | | | x | | float | | |
| | | | | | | | | | y | | float | | |
| | | | | | | | | | z | | float | | |

## 填写紧凑类型数据​

| ##var | id | pos |
| ---- | ---- | ---- |
| ##type | int | MyVec3 |
| ##group | | |
| ## | | |
| | 1 | 1,2,3 |
| | 2 | 2,2,2 |

提示

`Defines/builtin.xml`中已经默认定义了vec2、vec3、vec4等常见的类型，不必再重新定义。

