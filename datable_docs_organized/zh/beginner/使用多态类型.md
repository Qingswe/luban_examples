# 使用多态类型

> 来源: https://www.datable.cn/docs/beginner/usepolymorphismtype

  * [](/)
  * [新手教程](新手教程.md)
  * 使用多态类型

版本：4.x

本页总览

# 使用多态类型

并不是所有数据结构都是规范一致的，在复杂的GamePlay玩法中，经常出现Buff效果有非常多种类型，每种类型的字段都不一样。 如果简单地取它们的并集，即取一个大结构包含所有类型的字段，配置将非常臃肿和复杂。多态类型完美解决了此问题。

## 定义​

我们以Shape为例，Shape有很多子类，如圆、三角形、矩形。定义如下：

| ##var | full_name | parent | valueType | sep | alias | comment | group | tags | *fields | *fields | *fields | *fields | *fields | *fields | *fields |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| ##var | | | | | | | | | name | alias | type | group | comment | tags | variants |
| ## | 全名(包含模块和名字) | | 分割符 | | | | | | 字段名 | 字段别名 | 类型 | 分组 | 注释 | | 字段变体 |
| | Shape | | | | | | | | | | | | | | |
| | Circle | Shape | | | | | | | radius | | float | | | | |
| | Triangle | Shape | | | | | | | a | | float | | | | |
| | | | | | | | | | b | | float | | | | |
| | | | | | | | | | c | | float | | | | |
| | Rect | Shape | | | | | | | width | | float | | | | |
| | | | | | | | | | height | | float | | | | |

当一个类形有1个及以上子类时，称之为多态类型。每个子类型需要指定parent属性，如Circle的parent为Shape。

## 填写多态数据​

多态结构如普通结构那样，支持流式与sep。填写多态数据时，第一个数据必须是多态类型，如Circle。填写多态类型时也支持别名，如`矩形`。

| ##var | id | s1 | s1 | s1 | s1 | s2 | s3 | s3 | s3 | s3 | s3 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| ##type | int | | Shape | | | Shape#sep=, | list,(Shape#sep=,) | | | | |
| | 1 | Circle | 10 | | | Circle,10 | Circle | 10 | Rect | 10 | 20 |
| | | Triangle | 10 | 10 | 15 | Triangle,10,10,10 | Rect | 10 | 20 | | |
| | | Rect | 10 | 20 | | Rect,10,20 | Circle | 10 | Circle | 10 | |

支持列限定格式，此时需要用$type列来指定多态类型：

| ##var | id | s1 | s1 | s1 | s1 | s1 | s1 | s1 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| ##type | int | | | Shape | | | | |
| ##var | | $type | radius | a | b | c | width | height |
| | 1 | Circle | 10 | | | | | |
| | | Triangle | | 10 | 10 | 15 | | |
| | | Rect | | | | | 10 | 20 |

支持多行数据：

| ##var | id | *s1 | *s1 | *s1 | *s1 | *s2 | *s2 | *s2 | *s2 | *s2 | *s2 | *s2 | *s2 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| ##type | int | | list,Shape | | | | list,Shape | | | | | | |
| ##var | | | | | | $type | radius | a | b | c | width | height | |
| | 1 | Circle | 10 | | | Circle | 10 | | | | | | |
| | | Triangle | 10 | 10 | 10 | Triangle | | 10 | 10 | 15 | | | |
| | | Rect | 10 | 20 | | Rect | | | | | 10 | 20 | |
| | 1 | Circle | 10 | | | Circle | 10 | | | | | | |
| | | Triangle | 10 | 10 | 15 | Triangle | | 10 | 10 | 15 | | | |
| | | Rect | 20 | 30 | | Rect | | | | | 10 | 20 | |

